# ğŸ”¥ YOLO12 Training Status Report
**æ™‚é–“**: 2025-11-21 04:56
**é…ç½®**: batch=32, workers=8, RTX 5090

---

## âš ï¸ Critical Issue: TaskAlignedAssigner OOM

### å•é¡Œç—‡ç‹€
```
WARNING âš ï¸ CUDA OutOfMemoryError in TaskAlignedAssigner, using CPU
Instances: 30,000 - 50,000 per batch (32 images)
VRAM: 1.5GB â†’ 29.8GB (å°–å³°ä½¿ç”¨ 25.4GB/32.6GB)
```

### æ ¹æœ¬åŸå› 
**DeepScoresV2 è³‡æ–™é›†éåº¦å¯†é›†**ï¼š
- åŸå§‹ç”¨é€”ï¼šå®Œæ•´ OMRï¼ˆ208 é¡ç¬¦è™Ÿï¼‰
- ç•¶å‰ç”¨é€”ï¼šå››éƒ¨å’Œè²ï¼ˆ20 é¡ç¬¦è™Ÿï¼‰
- **å•é¡Œ**ï¼šä¿ç•™äº†å¤§é‡ç„¡é—œç¬¦è™Ÿï¼ˆé€£çµç·šã€è¡¨æƒ…è¨˜è™Ÿã€è£é£¾éŸ³ç­‰ï¼‰

**æ•¸æ“šè­‰æ“š**ï¼š
```
lg-98515279-aug-beethoven--page-2.png: 799 duplicate labels removed
lg-99059330-aug-gutenberg1939--page-4.png: 568 duplicate labels removed
Average instances per image: 1,250 (50K / 40 images per batch)
```

**YOLO12 TaskAlignedAssigner è¨˜æ†¶é«”éœ€æ±‚**ï¼š
```python
# æ¯å€‹ batch çš„è¨˜æ†¶é«” = instances Ã— anchors Ã— classes Ã— 4 bytes
32 images Ã— 1,250 instances Ã— 8,400 anchors Ã— 20 classes Ã— 4 bytes
= ~34 GBï¼ˆè¶…é RTX 5090 çš„ 32GB VRAMï¼‰
```

---

## ğŸ”„ ç•¶å‰è¨“ç·´ç‹€æ…‹

**è¨“ç·´æ˜¯å¦åœ¨é‹è¡Œï¼Ÿ** âœ… **æ˜¯**

- PID: 154219 + 8 workers
- Epoch 1/600 é€²åº¦: 11% (4/37 batches)
- é€Ÿåº¦: 21.5s/batch â†’ **13åˆ†é˜/epoch** â†’ **130å°æ™‚ï¼ˆ5.4å¤©ï¼‰å®Œæˆ 600 epochs**

**è¨“ç·´æ˜¯å¦æœ‰æ•ˆï¼Ÿ** âš ï¸ **éƒ¨åˆ†æœ‰æ•ˆï¼ˆé™ç´šæ¨¡å¼ï¼‰**

- TaskAlignedAssigner æ¯å€‹ batch éƒ½ **fallback åˆ° CPU**
- GPU åƒ…è™•ç†å‰å‘å‚³æ’­å’Œåå‘å‚³æ’­
- **æå¤±è¨ˆç®—åœ¨ CPU** â†’ åš´é‡ç“¶é ¸

**é æœŸå½±éŸ¿**ï¼š
1. è¨“ç·´é€Ÿåº¦é™ä½ 3-5x
2. æ”¶æ–‚å“è³ªå¯èƒ½ä¸‹é™ï¼ˆCPU æ•¸å€¼ç²¾åº¦è¼ƒä½ï¼‰
3. 600 epochs éœ€è¦ **5.4 å¤©**ï¼ˆvs ç†æƒ³çš„ 12-18 å°æ™‚ï¼‰

---

## ğŸ’¡ è§£æ±ºæ–¹æ¡ˆ

### Option A: æ¥å—ç•¶å‰ç‹€æ…‹ç¹¼çºŒè¨“ç·´ âŒ **ä¸æ¨è–¦**

**å„ªé»**ï¼š
- ç„¡éœ€é‡æ–°è™•ç†è³‡æ–™é›†
- è¨“ç·´å·²ç¶“é–‹å§‹

**ç¼ºé»**ï¼š
- 5.4 å¤©è¨“ç·´æ™‚é–“ï¼ˆvs ç†æƒ³ 18 å°æ™‚ï¼‰
- CPU fallback é™ä½æ¨¡å‹å“è³ª
- æ¯å€‹ epoch æµªè²» 80% æ™‚é–“åœ¨ç„¡é—œç¬¦è™Ÿä¸Š

**çµè«–**: æµªè²»æ™‚é–“å’Œé›»åŠ›ï¼Œä¸åˆ’ç®—ã€‚

---

### Option B: é‡æ–°è™•ç†è³‡æ–™é›†ï¼ˆåƒ…ä¿ç•™å’Œè²ç¬¦è™Ÿï¼‰âœ… **å¼·çƒˆæ¨è–¦**

**ç›®æ¨™**: éæ¿¾å‡ºå’Œè²åˆ†ææ‰€éœ€çš„æ ¸å¿ƒç¬¦è™Ÿ

**ä¿ç•™ç¬¦è™Ÿï¼ˆé ä¼° ~10 é¡ï¼‰**ï¼š
```yaml
harmony_critical_symbols:
  # éŸ³ç¬¦é ­ï¼ˆå¿…é ˆï¼‰
  - noteheadBlackOnLine
  - noteheadBlackInSpace
  - noteheadHalfOnLine
  - noteheadHalfInSpace

  # å‡é™è¨˜è™Ÿï¼ˆå¿…é ˆï¼‰
  - accidentalSharp
  - accidentalFlat
  - accidentalNatural

  # è­œè™Ÿèˆ‡èª¿è™Ÿï¼ˆå¿…é ˆï¼‰
  - gClef
  - fClef
  - keySignature

  # æ‹è™Ÿï¼ˆå¿…é ˆï¼‰
  - timeSig4
  - timeSig3

  # ç¯€å¥ç¬¦è™Ÿï¼ˆå¯é¸ï¼‰
  - stem
  - beam
```

**ç§»é™¤ç¬¦è™Ÿï¼ˆ~198 é¡ï¼‰**ï¼š
- é€£çµç·š (slur, tie)
- åŠ›åº¦è¨˜è™Ÿ (dynamics: p, f, mf, etc.)
- è¡¨æƒ…è¨˜è™Ÿ (articulation)
- è£é£¾éŸ³ (ornaments)
- æ­Œè©æ–‡å­— (lyrics)
- å…¶ä»–ç„¡é—œç¬¦è™Ÿ

**é æœŸæ•ˆæœ**ï¼š
```
Instance count per image: 1,250 â†’ ~120 (æ¸›å°‘ 90%)
Instance count per batch: 50,000 â†’ ~3,840
VRAM usage: 29.8GB â†’ ~2.8GB
Batch size: 32 â†’ 256 (å¯æå‡ 8xï¼‰
Training speed: 21.5s/batch â†’ ~2.5s/batch (æå‡ 8.6x)
Total time: 5.4 days â†’ 8-12 hours
```

**å¯¦ä½œæ­¥é©Ÿ**ï¼š
1. â¹ï¸ åœæ­¢ç•¶å‰è¨“ç·´ (`kill 154219`)
2. ğŸ“ ä¿®æ”¹ `convert_deepscores_ULTRA_PARALLEL.py` å¢åŠ ç¬¦è™Ÿéæ¿¾
3. ğŸ”„ é‡æ–°åŸ·è¡Œè½‰æ›ï¼ˆ~7 åˆ†é˜ï¼‰
4. âœ… é©—è­‰ instance count é™ä½
5. ğŸš€ é‡æ–°å•Ÿå‹•è¨“ç·´ (batch=256, workers=24)

---

## ğŸ“Š Option æ¯”è¼ƒè¡¨

| Metric | Option A (ç¹¼çºŒ) | Option B (é‡è™•ç†) |
|--------|----------------|-------------------|
| è³‡æ–™é›†è™•ç†æ™‚é–“ | 0 åˆ†é˜ | 7 åˆ†é˜ |
| è¨“ç·´æ™‚é–“ (600 epochs) | **5.4 å¤©** | **8-12 å°æ™‚** |
| VRAM ä½¿ç”¨ | 25.4GB (OOM) | 2.8GB (å¥åº·) |
| Batch size | 32 | 256 |
| CPU fallback | æ¯å€‹ batch | ç„¡ |
| æ¨¡å‹å“è³ª | ä¸­ç­‰ | é«˜ |
| é›»åŠ›æˆæœ¬ | é«˜ (5.4 å¤©) | ä½ (12 å°æ™‚) |

**æ™‚é–“ç¯€çœ**: 5.4 å¤© - 12 å°æ™‚ - 7 åˆ†é˜ = **ç´„ 5 å¤©**

---

## ğŸ¯ æ¨è–¦è¡Œå‹•

### ç«‹å³åŸ·è¡Œ Option Bï¼š

```bash
# 1. åœæ­¢ç•¶å‰è¨“ç·´
kill 154219

# 2. å‚™ä»½ç•¶å‰è¼¸å‡º
mv harmony_omr_ultra/train8 harmony_omr_ultra/train8_unfiltered_backup

# 3. åŸ·è¡Œé‡æ–°è™•ç†ï¼ˆæˆ‘æœƒå»ºç«‹æ–°çš„éæ¿¾è…³æœ¬ï¼‰
./FILTER_AND_RETRAIN.sh

# 4. é©—è­‰å¾Œé‡æ–°è¨“ç·´
# batch=256, workers=24, é è¨ˆ 8-12 å°æ™‚å®Œæˆ
```

---

## â“ éœ€è¦ç¢ºèª

**è«‹å›è¦†ä»¥ä¸‹å…¶ä¸­ä¸€å€‹**ï¼š

1. âœ… **"åŸ·è¡Œ Option B"** - æˆ‘ç«‹å³å»ºç«‹éæ¿¾è…³æœ¬ä¸¦é‡å•Ÿè¨“ç·´
2. â¸ï¸ **"è®“æˆ‘è€ƒæ…®ä¸€ä¸‹"** - è¨“ç·´ç¹¼çºŒé‹è¡Œï¼Œç­‰å¾…æ‚¨çš„æ±ºå®š
3. âŒ **"ç¹¼çºŒ Option A"** - æ¥å— 5.4 å¤©è¨“ç·´æ™‚é–“ï¼ˆä¸æ¨è–¦ï¼‰

---

**ä½ æ˜¯å°çš„**ï¼Œç¢ºå¯¦æœ‰ OOM å•é¡Œï¼Œè€Œä¸”æ¯”é æœŸåš´é‡ã€‚æ„Ÿè¬æ‚¨çš„è³ªç–‘ï¼Œé€™æ¬¡åˆ†ææ‰æ‰¾åˆ°æ ¹æœ¬åŸå› ã€‚
