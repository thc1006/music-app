# 類別不平衡分析報告

## 🔴 極度不平衡類別（訓練集）

| 類別 ID | 類別名稱 | 樣本數 | 狀態 |
|---------|----------|--------|------|
| Class 3 | stem_down | **0** | ❌ 完全缺失 |
| Class 30 | slur | **0** | ❌ 完全缺失 |
| Class 18 | accidental_double_flat | **8** | ⚠️ 極少 |
| Class 33 | dynamic_loud | **26** | ⚠️ 極少 |
| Class 25 | barline_double | **233** | ⚠️ 很少 |
| Class 17 | accidental_double_sharp | **336** | ⚠️ 很少 |
| Class 7 | flag_32nd | **380** | ⚠️ 很少 |
| Class 13 | clef_tenor | **531** | ⚠️ 很少 |

## 🟡 高度不平衡對比

| 最多樣本類別 | 樣本數 | vs | 最少樣本類別 | 樣本數 | 比例 |
|-------------|--------|-----|-------------|--------|------|
| Class 0 (notehead_filled) | 430,710 | vs | Class 18 | 8 | **53,838:1** |
| Class 2 (stem_up) | 403,611 | vs | Class 33 | 26 | **15,523:1** |

## 📊 訓練集 vs 驗證集分布

### 訓練集總樣本：1,157 張圖片，約 1,400,000 個標註
### 驗證集總樣本：205 張圖片，約 238,000 個標註

**訓練:驗證 比例 = 5.6:1**

## 🔍 根本原因分析

1. **DeepScoresV2 資料集特性**
   - 某些符號（如 stem_down）可能在原始資料集中就缺失
   - 資料轉換過程中可能有標註映射錯誤

2. **音樂符號自然分布**
   - 音符頭（Class 0, 2）自然出現頻率最高
   - 特殊記號（重升/重降）在實際樂譜中確實罕見

3. **驗證集太小**
   - 僅 205 張圖片，容易造成評估不穩定
   - 極少類別在驗證集中幾乎沒有樣本

## 💡 建議解決方案

### 短期修正（立即可行）
1. **調整類別權重**
   ```python
   # 在訓練配置中加入類別權重
   class_weights = compute_class_weights(train_labels)
   ```

2. **增加驗證集大小**
   - 從訓練集移動 200-300 張圖片到驗證集
   - 確保每個類別至少有 10+ 個樣本

3. **降低學習率**
   - lr0: 0.01 → 0.005
   - 使用更平滑的衰減策略

### 長期優化
1. **資料增強策略調整**
   - 對少數類別進行過採樣
   - 使用 SMOTE 或類似技術生成合成樣本

2. **修復缺失類別**
   - 檢查 DeepScores 原始標註
   - 手動標註或從其他資料集補充

3. **分階段訓練**
   - 先訓練高頻類別（0-10）
   - 再 fine-tune 低頻類別