# Phase 3 æœ€ä½³ç­–ç•¥ï¼šçªç ´ mAP50=0.509 ç“¶é ¸

> åŸºæ–¼å¤§è¦æ¨¡èª¿ç ”åˆ¶å®šçš„æœ€å„ªæ–¹æ¡ˆ

## ä¸€ã€ç“¶é ¸è¨ºæ–·ç¸½çµ

### æ ¸å¿ƒå•é¡Œ
- **3 å€‹é¡åˆ¥ mAP50=0**ï¼šdouble_sharpã€double_flatã€barline_double
- **é¡åˆ¥ä¸å¹³è¡¡æ¯”ä¾‹ 1421:1**ï¼šæœ€å¤§é¡ 1.2M vs æœ€å°é¡ 858
- **é©—è­‰é›†åˆ†ä½ˆç¼ºé™·**ï¼šæŸäº›é¡åˆ¥é©—è­‰æ¨£æœ¬ <20

### ç ”ç©¶ç™¼ç¾
- DeepScoresV2 ä½¿ç”¨ MusicXML â†’ LilyPond â†’ SVG ç®¡é“ï¼Œç²¾ç¢ºæ¨™è¨»
- ç²¾å¯†æ•¸æ“šå¢å¼·å¯å°‡æª¢æ¸¬æ€§èƒ½å¾ 36% æå‡åˆ° **73%**
- åˆæˆæ•¸æ“šå­˜åœ¨ã€Œç»ç’ƒå¤©èŠ±æ¿ã€æ•ˆæ‡‰ï¼Œéœ€æ··åˆçœŸå¯¦æ•¸æ“š

---

## äºŒã€ä¸‰ç®¡é½Šä¸‹ç­–ç•¥

### ç­–ç•¥ Aï¼šLilyPond ç²¾ç¢ºåˆæˆï¼ˆæ¨è–¦ï¼‰

**åŸç†**ï¼šåˆ©ç”¨ LilyPond çš„ SVG è¼¸å‡ºç²å–ç²¾ç¢ºçš„ç¬¦è™Ÿåº§æ¨™

```bash
# 1. å®‰è£ LilyPond
sudo apt install lilypond

# 2. ç”Ÿæˆå¸¶åº§æ¨™çš„ SVG
lilypond -dbackend=svg --svg output.ly

# 3. è§£æ SVG ç²å– bounding box
# SVG ä¸­æ¯å€‹éŸ³æ¨‚ç¬¦è™Ÿéƒ½æœ‰ç²¾ç¢ºçš„ transform å’Œå°ºå¯¸ä¿¡æ¯
```

**å„ªå‹¢**ï¼š
- æ¨™è¨» 100% ç²¾ç¢º
- å¯æ§åˆ¶ä»»ä½•é¡åˆ¥çš„ç”Ÿæˆæ•¸é‡
- å¤šå­—é«”è®Šç•°ï¼ˆemmentaler, gonville, beethoven, feta, lilyjazzï¼‰

**å¯¦ä½œè¦é»**ï¼š
```python
# LilyPond SVG è¼¸å‡ºä¸­çš„ç¬¦è™Ÿä½ç½®
# <use xlink:href="#noteheads.s2" transform="translate(x, y)"/>
# éœ€è¦è§£æ SVG çš„ transform å±¬æ€§ä¾†ç²å–åº§æ¨™
```

### ç­–ç•¥ Bï¼šCopy-Paste å¢å¼·ï¼ˆå¿«é€Ÿæ–¹æ¡ˆï¼‰

**åŸç†**ï¼šå¾ç¾æœ‰è¨“ç·´æ•¸æ“šè£å‰ªç¨€æœ‰ç¬¦è™Ÿï¼Œè²¼åˆ°å…¶ä»–åœ–ç‰‡

**å„ªå‹¢**ï¼š
- ä¸éœ€è¦å¤–éƒ¨å·¥å…·
- ç¬¦è™Ÿä¾†è‡ªçœŸå¯¦æ•¸æ“šï¼Œè¦–è¦ºçœŸå¯¦
- å¯¦ä½œç°¡å–®ï¼Œå¯ç«‹å³åŸ·è¡Œ

**è…³æœ¬**ï¼š`phase3_copy_paste_augmentation.py`

### ç­–ç•¥ Cï¼šDeepScores é‡æ–°æ˜ å°„

**åŸç†**ï¼šDeepScoresV2 åŸå§‹æ•¸æ“šæœ‰ 135 é¡ï¼Œé‡æ–°æ˜ å°„åˆ°æˆ‘å€‘çš„ 33 é¡

**å¯¦ä½œ**ï¼š
```python
# DeepScores â†’ Our Classes æ˜ å°„
DEEPSCORES_MAPPING = {
    "accidentalDoubleFlat": 17,  # double_flat
    "accidentalDoubleSharp": 16, # double_sharp
    "barlineDouble": 24,         # barline_double
    # ... æ›´å¤šæ˜ å°„
}
```

**å„ªå‹¢**ï¼š
- æ¨™è¨»å·²ç¶“å­˜åœ¨æ–¼ ds2_dense/deepscores_train.json
- åªéœ€é¡åˆ¥æ˜ å°„å’Œæ ¼å¼è½‰æ›
- å¯ç²å¾—æ›´å¤šç¨€æœ‰é¡åˆ¥æ¨£æœ¬

---

## ä¸‰ã€æ¨è–¦åŸ·è¡Œé †åº

### Phase 3.1ï¼šDeepScores é‡æ–°æ˜ å°„ï¼ˆ1-2 å°æ™‚ï¼‰
1. åˆ†æ ds2_dense ä¸­ç¨€æœ‰é¡åˆ¥çš„åˆ†ä½ˆ
2. å»ºç«‹é¡åˆ¥æ˜ å°„è¡¨
3. è½‰æ›ç‚º YOLO æ ¼å¼
4. åˆä½µåˆ°è¨“ç·´é›†

### Phase 3.2ï¼šCopy-Paste å¢å¼·ï¼ˆ2-3 å°æ™‚ï¼‰
1. æå–ç¨€æœ‰é¡åˆ¥ç¬¦è™Ÿï¼ˆç´„ 30 åˆ†é˜ï¼‰
2. ç”Ÿæˆå¢å¼·åœ–ç‰‡ï¼ˆç´„ 1-2 å°æ™‚ï¼‰
3. åˆä½µæ•¸æ“šé›†

### Phase 3.3ï¼šLilyPond ç²¾ç¢ºåˆæˆï¼ˆå¯é¸ï¼Œ4-6 å°æ™‚ï¼‰
1. å®‰è£ LilyPond
2. å¯¦ä½œ SVG åº§æ¨™è§£æå™¨
3. é‡å° mAP50=0 çš„é¡åˆ¥ç”Ÿæˆåˆæˆæ•¸æ“š
4. é©—è­‰æ¨™è¨»è³ªé‡

### Phase 3.4ï¼šè¨“ç·´
```bash
source venv_yolo12/bin/activate
python yolo12_train_phase3.py
```

---

## å››ã€é æœŸæ•ˆæœ

| Phase | ç­–ç•¥ | é æœŸ mAP50 æå‡ | æ™‚é–“æŠ•å…¥ |
|-------|------|-----------------|----------|
| 3.1 | DeepScores é‡æ˜ å°„ | +5-8% | 1-2 å°æ™‚ |
| 3.2 | Copy-Paste | +3-5% | 2-3 å°æ™‚ |
| 3.3 | LilyPond åˆæˆ | +5-10% | 4-6 å°æ™‚ |
| ç¸½è¨ˆ | ä¸‰ç®¡é½Šä¸‹ | **0.509 â†’ 0.65-0.70** | 1-2 å¤© |

---

## äº”ã€é•·æœŸè·¯ç·š

æ ¹æ“š [PERFECT_MODEL_STRATEGY.md] çš„å…­éšæ®µè¦åŠƒï¼š

```
Phase 2 âœ…: mAP50 = 0.509
Phase 3 ğŸ¯: ç›®æ¨™ 0.65-0.70 (åˆæˆæ•¸æ“š)
Phase 4: ç›®æ¨™ 0.80-0.85 (é«˜è§£æåº¦+æ¶æ§‹)
Phase 5: ç›®æ¨™ 0.85-0.90 (çœŸå¯¦æ•¸æ“š)
Phase 6: ç›®æ¨™ 0.90+ (ç”Ÿç”¢å„ªåŒ–)
```

---

## å…­ã€åƒè€ƒè³‡æº

- [OMR-Datasets](https://github.com/apacha/OMR-Datasets) - æ•¸æ“šé›†é›†åˆ
- [DeepScoresV2](https://zenodo.org/records/4012193) - åŸå§‹æ•¸æ“šé›†
- [Audiveris Synthetic Images](https://github.com/Audiveris/omr-dataset-tools/wiki/Synthetic-Images) - åˆæˆæ–¹æ³•
- [oemer](https://github.com/BreezeWhite/oemer) - End-to-end OMR å·¥å…·

---

*å‰µå»ºæ—¥æœŸï¼š2025-11-24*
*åŸºæ–¼å¤§è¦æ¨¡èª¿ç ”åˆ¶å®š*
